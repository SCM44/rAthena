//===== rAthena Script =======================================
//= Izlude Deepsea Instance (kRo Zero)
//============================================================

//Mapflag
1@izu	mapflag	nomemo
1@izu	mapflag	nosave	SavePoint
1@izu	mapflag	nowarp
1@izu	mapflag	nowarpto
1@izu	mapflag	noreturn
1@izu	mapflag	nobranch
1@izu	mapflag	noicewall
1@izu	mapflag	partylock
1@izu	mapflag	noteleport
1@izu	mapflag	monster_noteleport

// Instance Timer (custom)
1@izu,3,1,5	script	#izu_timer	CLEAR_NPC,{
	end;
OnStartTimer:
	initnpctimer;
	end;
OnStopTimer:
	//callfunc("F_InstanceTimer","iz",getnpctimer(0),'Mode);
	//callfunc("F_UpdateInsRecord");
	end;
OnTimer3600000:
	stopnpctimer;
	end;
OnInstanceInit:
	hideonnpc instance_npcname("#izu_timer");
	end;
}


1@izu,239,211,3	script	Memorial Society Member#izu2	702,9,9,{
	if(getcharid(0) != getpartyleader(getcharid(1),2)) {
		mes "["+strnpcinfo(1)+"]";
		mes "I wish to talk to your Party Leader.";
		close;
	}
	'party_id = getcharid(1);
	mes "["+strnpcinfo(1)+"]";
	mes "I'm looking for ^0000FFclues^000000 about a mysterious deep sea creature!";
	npctalk "I'm looking for clues about a mysterious deep sea creature!";
	next;
	mes "["+strnpcinfo(1)+"]";
	mes "If you find any signs pointing towards its existence, it would be of great help!";
	npctalk "If you find any signs pointing towards its existence, it would be of great help!";
	next;
	mes "["+strnpcinfo(1)+"]";
	mes "Do you think that you can help me in searching for it?";
	npctalk "Do you think that you can help me in searching for it?";
	next;
	mes "["+strnpcinfo(1)+"]";
	mes "Good luck in searching for the deep sea creature!";
	npctalk "Good luck in searching for the deep sea creature!";
	close2;
	hideonnpc instance_npcname(strnpcinfo(0));
	donpcevent instance_npcname("Memorial Society Member#izu2") + "::OnStart"; 
	donpcevent instance_npcname("#izu_timer") + "::OnStartTimer"; 
	end;

OnTouch_:
//	npctalk "Welcome to Izlude Deepsea~";
	end;
	
OnInstanceInit:
	'Mode = 0;
	'Geyser_1 = 0;
	'Geyser_2 = 0;
	'Geyser_3 = 0;
	'Geyser_4 = 0;
	'Boss = 0;
	'Map$ = instance_mapname("1@izu");
	end;
	
OnStart:
	//Retrieve Mode Modifiers
	.@arr$ = getvariableofnpc(.mode_config$,"#Instance_Config");
	explode(.@mod$,.@arr$,"-");
	for(.@i=0; .@i<getarraysize(.@mod$); .@i+=10) {
		if(atoi(.@mod$[.@i]) == 'Mode) {
			.@hp_mod = atoi(.@mod$[.@i+1]);
			.@atk_mod = atoi(.@mod$[.@i+2]);
			.@amt_mod = atoi(.@mod$[.@i+3]);
			'boss_hp_mod  = atoi(.@mod$[.@i+4]);
			'boss_atk_mod  = atoi(.@mod$[.@i+5]);
			'boss_def_mod  = atoi(.@mod$[.@i+6]);
			'boss_mdef_mod = atoi(.@mod$[.@i+7]);
			'boss_hit_mod  = atoi(.@mod$[.@i+8]);
			'boss_flee_mod = atoi(.@mod$[.@i+9]);
			break;
		}
	}
		
	//Spawn Dynamic Mobs
	setarray .@m_info,20082,20,20083,50,20084,15,20085,20;
	.@label$ = instance_npcname(strnpcinfo(0))+"::OnMobBuff";
	for(.@m=0; .@m<getarraysize(.@m_info); .@m+=2) {
		
		//Initialize Array
		deletearray $@mobid[0],getarraysize($@mobid);

		.@mob$ = .@m_info[.@m]+"_";
		.@amt = .@m_info[.@m+1] * .@amt_mod;
		areamonster 'Map$,51,43,350,332,"--ja--",.@m_info[.@m],.@amt,.@label$;
		
		for(.@i = 0; .@i < getarraysize($@mobid); .@i++) {
<<<<<<< HEAD
			setd("'"+.@mob$+.@i), $@mobid[.@i];
=======
			setd(".@"+.@mob$+.@i), $@mobid[.@i];
>>>>>>> bf22a4018d122d26125cb20e8dd71a833beeb988
			if(unitexists(getd("'"+.@mob$+.@i))) {
				getunitdata getd("'"+.@mob$+.@i),.@data;
				setunitdata getd("'"+.@mob$+.@i),UMOB_MAXHP,.@data[UMOB_MAXHP] * .@hp_mod;
				setunitdata getd("'"+.@mob$+.@i),UMOB_HP,.@data[UMOB_HP] * .@hp_mod;		
				setunitdata getd("'"+.@mob$+.@i),UMOB_ATKMIN,.@data[UMOB_ATKMIN] * .@atk_mod;
				setunitdata getd("'"+.@mob$+.@i),UMOB_ATKMAX,.@data[UMOB_ATKMAX] * .@atk_mod;
			}
		}
		if(strpos("20083,20084",""+.@m_info[.@m]) != -1) setarray 'buff_mobs,.@m_info[.@m],.@amt;
	}
	//NPCs
	for(.@i = 1; .@i <= 4; .@i++) {
		hideoffnpc instance_npcname("Seabed Indentation#"+.@i);
		enablenpc instance_npcname("Seabed Indentation#"+.@i);
		initnpctimer instance_npcname("Seabed Indentation#"+.@i);
	}
	end;
OnMobBuff:
	instance_announce 0,"The soul of the defeated monster has enchanced the abilities of his felllow sea creatures.",bc_map,"0xFFFFFF",FW_BOLD;	
	
	for(.@m=0; .@m<getarraysize('buff_mobs); .@m+=2) {
		
		.@mob$ = replacestr(getmonsterinfo(.@m_info[.@m],0)," ","_");
		
		for(.@i = 1; .@i <= 'buff_mobs[.@m+1]; .@i++) {
			//if(getd("'Merman"+.@i) == 0) continue;
			if(unitexists(getd("'Merman"+.@i))) {
				if(unitexists(getd("'"+.@mob$+.@i))) {
					getunitdata getd("'"+.@mob$+.@i),.@data;
					setunitdata getd("'"+.@mob$+.@i),UMOB_MAXHP,.@data[UMOB_MAXHP] + 1000;
					setunitdata getd("'"+.@mob$+.@i),UMOB_HP,.@data[UMOB_HP] + 1000;	
					setunitdata getd("'"+.@mob$+.@i),UMOB_ATKMIN,.@data[UMOB_ATKMIN] + 150;
					setunitdata getd("'"+.@mob$+.@i),UMOB_ATKMAX,.@data[UMOB_ATKMAX] + 150;
				}
			}
		}
	}
	end;
	
OnBoss:
	sleep 9000;
	instance_announce 0,"Deepsea Coelacanth: Earthdwellers, accept the sea as your tomb!!",bc_map,"0xFFFFFF",FW_BOLD;	
	
	//Initialize Array
	deletearray $@mobid[0],getarraysize($@mobid);
		
	if('Boss == 0) monster instance_mapname("1@izu"),236,214,"--ja--",20081,1,instance_npcname("Memorial Society Member#izu2") + "::OnBossDead";
	'Boss = $@mobid[0];
	if(unitexists('Boss)) {
		unittalk 'Boss,"Earthdwellers, before the might of the sea!!";
		
		//Apply Modifiers
		getunitdata 'Boss,.@boss_data;
		setunitdata 'Boss,UMOB_MAXHP,.@boss_data[UMOB_MAXHP] * 'boss_hp_mod;
		setunitdata 'Boss,UMOB_HP,.@boss_data[UMOB_HP] * 'boss_hp_mod;
		setunitdata 'Boss,UMOB_ATKMIN,.@boss_data[UMOB_ATKMIN] * 'boss_atk_mod;
		setunitdata 'Boss,UMOB_ATKMAX,.@boss_data[UMOB_ATKMAX] * 'boss_atk_mod;
		setunitdata 'Boss,UMOB_MATKMIN,.@boss_data[UMOB_MATKMIN] * 'boss_atk_mod;
		setunitdata 'Boss,UMOB_MATKMAX,.@boss_data[UMOB_MATKMAX] * 'boss_atk_mod;
		setunitdata 'Boss,UMOB_DEF,.@boss_data[UMOB_DEF] * 'boss_def_mod;
		setunitdata 'Boss,UMOB_MDEF,.@boss_data[UMOB_MDEF] * 'boss_mdef_mod;
		setunitdata 'Boss,UMOB_HIT,.@boss_data[UMOB_HIT] * 'boss_hit_mod ;
		setunitdata 'Boss,UMOB_FLEE,.@boss_data[UMOB_FLEE] * 'boss_flee_mod;
	}
	
	initnpctimer;
	end;
	
OnTimer5000:
	'Bones = 0;
	if(unitexists('Boss)) {
		getunitdata 'Boss, .@arr;
		.@label$ = instance_npcname("Memorial Society Member#izu2") + "::OnThorn";
		.@percent_hp = (.@arr[UMOB_HP] * 100) / .@arr[UMOB_MAXHP];
		.@mobx = .@arr[UMOB_X];
		.@moby = .@arr[UMOB_Y];

		// event type every 10%
		.@x1 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);
		.@y1 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);
		
		.@x2 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);
		.@y2 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);
		
		.@x3 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);
		.@y3 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);
		
		.@x4 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);
		.@y4 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);
		
		.@x5 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);
		.@y5 = F_Rand(-7,-6,-5,-4,-3,3,4,5,6,7);

		switch( .@percent_hp / 10 ) {
		case 10: 
		case 9:
		case 8:
			'Bones = 1;
			monster 'Map$[0],.@mobx+.@x1,.@moby+.@y1,"",1960,1, .@label$;
			break;	
		case 7:
		case 6:
		case 5:
			'Bones = 2;
			monster 'Map$[0],.@mobx+.@x1,.@moby+.@y1,"",1960,1, .@label$;
			monster 'Map$[0],.@mobx+.@x2,.@moby+.@y2,"",1960,1, .@label$;
			break;		
		case 4:
		case 3:	
			'Bones = 3;
			monster 'Map$[0],.@mobx+.@x1,.@moby+.@y1,"",1960,1, .@label$;
			monster 'Map$[0],.@mobx+.@x2,.@moby+.@y2,"",1960,1, .@label$;
			monster 'Map$[0],.@mobx+.@x3,.@moby+.@y2,"",1961,1, .@label$;
			break;	
		case 2:
		case 1:
		case 0:
			'Bones = 5;
			monster 'Map$[0],.@mobx+.@x1,.@moby+.@y1,"",1960,1, .@label$;
			monster 'Map$[0],.@mobx+.@x2,.@moby+.@y2,"",1960,1, .@label$;
			monster 'Map$[0],.@mobx+.@x3,.@moby+.@y3,"",1960,1, .@label$;
			monster 'Map$[0],.@mobx+.@x4,.@moby+.@y4,"",1960,1, .@label$;
			monster 'Map$[0],.@mobx+.@x5,.@moby+.@y5,"",1961,1, .@label$;
			break;	
		}
	}
	end;
	
OnTimer65000:
	.@label$ = instance_npcname("Memorial Society Member#izu2") + "::OnThorn";
	killmonster 'Map$[0], .@label$;
	instance_announce 0,"The Coelacanth has feasted on "+'Bones+" bones, recovering "+('Bones * 9999)+" HP in total.",bc_map,"0xFFFFFF",FW_BOLD;
	if(unitexists('Boss)) {
		getunitdata 'Boss, .@arr;
		setunitdata 'Boss,UMOB_HP,.@arr[UMOB_HP] + ('Bones * 9999);
	}	
	movenpc instance_npcname(strnpcinfo(0)),.@arr[UMOB_X],.@arr[UMOB_Y];
	specialeffect EF_HEAL,AREA,instance_npcname(strnpcinfo(0));
	initnpctimer;
	end;
			
OnThorn:
	end;
	
OnBossDead:
	stopnpctimer;
	.@label$ = instance_npcname("Memorial Society Member#izu2") + "::OnThorn";
	killmonster 'Map$[0], .@label$;
	if ('Mode == 1) {
		enablenpc instance_npcname("Treasure Chest#izu1");
	} else {
		'unique_members = min(MAX_PARTY, callfunc("F_GetUniquePartyMemberCountInMap", getcharid(1), 'Map$)); // Cap to MAX_PARTY
		'RewardUniqueIDLogs$ = "";
		for (.@i = 1; .@i <= 'unique_members; ++.@i) {
			enablenpc instance_npcname("Treasure Chest#izu" + .@i);
		}
	}
	donpcevent instance_npcname("#izu_timer") + "::OnStopTimer";
	end;
}


1@izu,51,353,4	script	Seabed Indentation#1	723,{
	if(!'Geyser_1) {
		specialeffect2 12;
		progressbar "ffff00",10;
		'Geyser_1 = 1;
		message strcharinfo(0),"It seemed as if something huge and heavy rested here...";
		.@sum = ('Geyser_1 + 'Geyser_2 + 'Geyser_3 + 'Geyser_4);
		if(.@sum == 4) donpcevent instance_npcname("Memorial Society Member#izu2") + "::OnBoss";
			else instance_announce 0,"Remaining seabed Indentation to investigate: "+(4-.@sum),bc_map,"0xFFFFFF",FW_BOLD;		
		hideonnpc instance_npcname(strnpcinfo(0));
	} else {
		message strcharinfo(0),"Let's investigate elsewhere";
	}
	end;

OnTimer9000:
	specialeffect 247;
	initnpctimer;
	end;
OnInstanceInit:
	hideonnpc instance_npcname(strnpcinfo(0));
	disablenpc instance_npcname(strnpcinfo(0));
	end;	
}

1@izu,45,59,4	script	Seabed Indentation#2	723,{
	if(!'Geyser_2) {
		specialeffect2 12;
		progressbar "ffff00",10;
		'Geyser_2 = 1;
		message strcharinfo(0),"It seemed as if something huge and heavy rested here...";
		.@sum = ('Geyser_1 + 'Geyser_2 + 'Geyser_3 + 'Geyser_4);
		if(.@sum == 4) donpcevent instance_npcname("Memorial Society Member#izu2") + "::OnBoss";
			else instance_announce 0,"Remaining seabed Indentation to investigate: "+(4-.@sum),bc_map,"0xFFFFFF",FW_BOLD;	
		hideonnpc instance_npcname(strnpcinfo(0));
	} else {
		message strcharinfo(0),"Let's investigate elsewhere";
	}
	end;
	
OnTimer9000:
	specialeffect 247;
	initnpctimer;
	end;
OnInstanceInit:
	hideonnpc instance_npcname(strnpcinfo(0));
	disablenpc instance_npcname(strnpcinfo(0));
	end;			
}

1@izu,339,331,4	script	Seabed Indentation#3	723,{
	if(!'Geyser_3) {
		specialeffect2 12;
		progressbar "ffff00",10;
		'Geyser_3 = 1;
		message strcharinfo(0),"It seemed as if something huge and heavy rested here...";
		.@sum = ('Geyser_1 + 'Geyser_2 + 'Geyser_3 + 'Geyser_4);
		if(.@sum == 4) donpcevent instance_npcname("Memorial Society Member#izu2") + "::OnBoss";
			else instance_announce 0,"Remaining seabed Indentation to investigate: "+(4-.@sum),bc_map,"0xFFFFFF",FW_BOLD;	
		hideonnpc instance_npcname(strnpcinfo(0));
	} else {
		message strcharinfo(0),"Let's investigate elsewhere";
	}
	end;
	
OnTimer9000:
	specialeffect 247;
	initnpctimer;
	end;
OnInstanceInit:
	hideonnpc instance_npcname(strnpcinfo(0));
	disablenpc instance_npcname(strnpcinfo(0));
	end;		
}

1@izu,327,64,4	script	Seabed Indentation#4	723,{
	if(!'Geyser_4) {
		specialeffect2 12;
		progressbar "ffff00",10;
		'Geyser_4 = 1;
		message strcharinfo(0),"It seemed as if something huge and heavy rested here...";
		.@sum = ('Geyser_1 + 'Geyser_2 + 'Geyser_3 + 'Geyser_4);
		if(.@sum == 4) donpcevent instance_npcname("Memorial Society Member#izu2") + "::OnBoss";
			else instance_announce 0,"Remaining seabed Indentation to investigate: "+(4-.@sum),bc_map,"0xFFFFFF",FW_BOLD;
		hideonnpc instance_npcname(strnpcinfo(0));
	} else {
		message strcharinfo(0),"Let's investigate elsewhere";
	}
	end;
	
OnTimer9000:
	specialeffect 247;
	initnpctimer;
	end;
OnInstanceInit:
	hideonnpc instance_npcname(strnpcinfo(0));
	disablenpc instance_npcname(strnpcinfo(0));
	end;			
}


1@izu,236,214,4	script	Treasure Chest#izu1	4_TREASURE_BOX,{
	.@unique_id = callfunc("F_GetUniqueID", getcharid(3));
	if ('Mode >= 2) {
		if (strpos('RewardUniqueIDLogs$, ""+.@unique_id) != -1) {
			end;
		}
		'RewardUniqueIDLogs$ = 'RewardUniqueIDLogs$ + "||" + .@unique_id;
	}
	
	set .@ins_map$,strcharinfo(3);
	getpartymember(getcharid(1)),2;
	for( .@i = 0; .@i < $@partymembercount; .@i++ ) {
		if (attachrid($@partymemberaid[.@i])) {
			if (strcharinfo(3) == .@ins_map$) {
				.@party_inmap++;
			}
			detachrid;
		}
	}
	if(.@party_inmap >=6 && .@party_inmap <12) .@bonus = 5;
		else if (.@party_inmap >=12) .@bonus = 15;
		else .@bonus = 0;
		
	if('Mode <= 2) {
		setarray .@reward[1],
		25424,100,	//Shimmering_Crystal
		25424,70,	//Shimmering_Crystal
		25424,40,	//Shimmering_Crystal
		29587,50,	//Shimmering_Crystal_Box
		29587,25,	//Shimmering_Crystal_Box
<<<<<<< HEAD
		18005,50,	//Mixed_Rune_Fragment
		18005,1,	//Mixed_Rune_Fragment
		29586,10,	//Refine_Box
		29586,10,	//Refine_Box
=======
		18005,10,	//Mixed_Rune_Fragment
		18005,5,	//Mixed_Rune_Fragment
		18005,1,	//Mixed_Rune_Fragment
		29586,5,	//Refine_Box
		29586,3,	//Refine_Box
>>>>>>> bf22a4018d122d26125cb20e8dd71a833beeb988
		29584,1,	//Rune_Box
		29584,1,	//Rune_Box
		29585,5,	//Pvm_Box
		29585,3,	//Pvm_Box
		23649,100,	//Gel_Fragment_Box
		23649,70,	//Gel_Fragment_Box
		23649,40,	//Gel_Fragment_Box
		29589,50,	//Crimson_Crystal_Box
		29589,25,	//Crimson_Crystal_Box
		25476,100,	//Crimson_Magic_Crystal
		25476,70,	//Crimson_Magic_Crystal
<<<<<<< HEAD
		25476,40,	//Crimson_Magic_Crystal
		6635,1;		//Blacksmith Blessing
	} else if ('Mode == 3) {
		setarray .@reward[1],
		//25459,100,	//Aqua_Sapphire
		//25459,50,	//Aqua_Sapphire
		//25459,10,	//Aqua_Sapphire
		25424,100,	//Shimmering_Crystal
		25424,70,	//Shimmering_Crystal
		25424,40,	//Shimmering_Crystal
		18005,100,	//Mixed_Rune_Fragment
		29586,20,	//Refine_Box
		29586,20,	//Refine_Box
		29584,2,	//Rune_Box
		29585,10,	//Pvm_Box
		29584,5,	//Rune_Box
		29585,5,	//Pvm_Box
		29587,100,	//Shimmering_Crystal_Box
		29587,50,	//Shimmering_Crystal_Box
		29589,100,	//Crimson_Crystal_Box
		29589,50,	//Crimson_Crystal_Box
=======
		25476,40;	//Crimson_Magic_Crystal
	} else if ('Mode == 3) {
		setarray .@reward[1],
		25459,100,	//Aqua_Sapphire
		25459,50,	//Aqua_Sapphire
		25459,10,	//Aqua_Sapphire
		29586,5,	//Refine_Box
		29586,3,	//Refine_Box
		29584,2,	//Rune_Box
		29585,5,	//Pvm_Box
		29587,50,	//Shimmering_Crystal_Box
		29587,25,	//Shimmering_Crystal_Box
		29589,50,	//Crimson_Crystal_Box
		29589,25,	//Crimson_Crystal_Box
>>>>>>> bf22a4018d122d26125cb20e8dd71a833beeb988
		756,100,	//Oridecon_Stone
		756,100,	//Oridecon_Stone
		756,20,		//Oridecon_Stone
		756,20,		//Oridecon_Stone
		756,20,		//Oridecon_Stone
		756,20,		//Oridecon_Stone
		757,100,	//Elunium_Stone
		757,100,	//Elunium_Stone
		757,20,		//Elunium_Stone
		757,20,		//Elunium_Stone
		757,20,		//Elunium_Stone
		757,20,		//Elunium_Stone
		984,100,	//Oridecon
		984,15,		//Oridecon
		984,15,		//Oridecon
		985,100,	//Elunium
		985,15,		//Elunium
		985,15,		//Elunium
<<<<<<< HEAD
		//25429,100,	//Mythril_Ore
		//25429,100,	//Mythril_Ore
		//25429,100,	//Mythril_Ore
		//25429,70,	//Mythril_Ore
		//25429,70,	//Mythril_Ore
		//25429,70,	//Mythril_Ore
		//25429,40,	//Mythril_Ore
		//25429,40,	//Mythril_Ore
		//25429,40,	//Mythril_Ore
		//25429,10,	//Mythril_Ore
		//25429,10,	//Mythril_Ore
		//25429,10,	//Mythril_Ore
=======
		25429,100,	//Mythril_Ore
		25429,100,	//Mythril_Ore
		25429,100,	//Mythril_Ore
		25429,70,	//Mythril_Ore
		25429,70,	//Mythril_Ore
		25429,70,	//Mythril_Ore
		25429,40,	//Mythril_Ore
		25429,40,	//Mythril_Ore
		25429,40,	//Mythril_Ore
		25429,10,	//Mythril_Ore
		25429,10,	//Mythril_Ore
		25429,10,	//Mythril_Ore
>>>>>>> bf22a4018d122d26125cb20e8dd71a833beeb988
		990,100,	//Boody_Red
		990,20,		//Boody_Red
        991,100,	//Crystal_Blue
		991,20,		//Crystal_Blue
		992,100,	//Wind_Of_Verdure 
		992,20,		//Wind_Of_Verdure 
		993,100,	//Yellow_Live
<<<<<<< HEAD
		993,20,		//Yellow_Live
		6635,10;	//Blacksmith Blessing

=======
		993,20;		//Yellow_Live
>>>>>>> bf22a4018d122d26125cb20e8dd71a833beeb988
	}
	getmapxy(.@map$,.@x,.@y,BL_NPC,instance_npcname(strnpcinfo(0)));
	
	specialeffect 10; //55462
	specialeffect 307; //Forest Light
	hideonnpc instance_npcname(strnpcinfo(0)); //55462
	
	.@limit = getarraysize(.@reward);
	for(.@i = 1; .@i<=.@limit; .@i+=2) {
		if(rand(100) < (.@reward[.@i+1] + .@bonus))
			makeitem .@reward[.@i],1,.@map$,.@x+rand(3)-1,.@y+rand(3)-1;
	}
	// Azure Crystal
	for(.@i = 0; .@i < 'unique_members + 5; ++.@i) {
		makeitem 25475, 1, .@map$, .@x+rand(3)-1, .@y+rand(3)-1;
	}
	// Crimson Magic Crystal
	for(.@i = 0; .@i < 'unique_members + 3; ++.@i) {
		makeitem 25476, 1, .@map$, .@x+rand(3)-1, .@y+rand(3)-1;
	}
	enablenpc instance_npcname("Memorial Society Member#izu3");
	end;
	
OnInstanceInit:
	disablenpc instance_npcname(strnpcinfo(0)); //55462
	end;	
}

1@izu,233,218,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu2	10005
1@izu,233,221,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu3	10005
1@izu,227,221,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu4	10005
1@izu,227,218,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu5	10005
1@izu,227,215,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu6	10005
1@izu,227,212,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu7	10005
1@izu,223,212,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu8	10005
1@izu,223,217,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu9	10005
1@izu,235,207,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu10	10005
1@izu,239,205,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu11	10005
1@izu,244,208,4	duplicate(Treasure Chest#izu1)	Treasure Chest#izu12	10005

1@izu,240,217,4	script	Memorial Society Member#izu3	702,{
	mes "["+strnpcinfo(1)+"]";
	mes "You have completed your objective!";
	mes "I think that we will meet again.";
	next;
	mes "["+strnpcinfo(1)+"]";
	mes "Wanna get out of here?";
	if(select("No:Yes")==1) close;
	// switch('Mode)	{
	// 	case 1: callfunc("DWM_Counter",13); break;
	// 	case 2: callfunc("DWM_Counter",14); break;
	// 	case 3: callfunc("DWM_Counter",15); break;
	// }
	warp "prt_fild06",47,198;
	end;

OnInstanceInit:
	disablenpc instance_npcname(strnpcinfo(0)); //55462
	end;	
}
